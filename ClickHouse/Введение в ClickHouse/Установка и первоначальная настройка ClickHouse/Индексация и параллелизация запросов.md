В ClickHouse индексация и параллелизация запросов играют ключевую роль в производительности системы, обеспечивая быстрое выполнение аналитических запросов на больших объемах данных. Рассмотрим эти аспекты более подробно:

### Индексация в ClickHouse

1. Индексированный доступ:
- В отличие от традиционных реляционных баз данных, ClickHouse использует несколько типов индексов для улучшения скорости выполнения запросов. Основной механизм индексации заключается в сжатии и хранении данных по блокам, чтобы минимизировать время чтения.

2. Primary Key и Order By:
- При создании таблицы в ClickHouse вы указываете ORDER BY, который определяет порядок хранения строк в таблице. Этот порядок также используется как первичный ключ, что значительно ускоряет выборку данных по условиям.
- Пример:
```sql
CREATE TABLE example (
         id UInt32,
         name String
     ) ENGINE = MergeTree()
     ORDER BY id;
```

3. Секундные индексы:
- ClickHouse использует секундные индексы для оптимизации доступа к данным по диапазонам значений. Каждый блок данных содержит информацию о значениях в каждом столбце, что позволяет эффективно пропускать ненужные блоки.
- Пример: min, max, count и другой статистики по столбцам сохраняется в метаданных, что позволяет ClickHouse быстро проверять, может ли блок содержать запрашиваемые данные, прежде чем загружать его в память.

4. Bloom Filters:
- Bloom filters – это разновидность индекса, которая помогает быстро определить, присутствует ли значение в столбце, позволяя избежать лишних обращений к данным.
- Пример:
```sql
CREATE TABLE example (
         id UInt32,
         name String
     ) ENGINE = MergeTree()
     ORDER BY id
     SETTINGS index_granularity = 8192, bloom_filter_columns = ['name'];
```

### Параллелизация запросов

1. Многопоточность:
- ClickHouse был разработан с учетом принципа параллельной обработки данных. Система делит запросы на множество подзадач, которые обрабатываются параллельно, используя все доступные ядра процессора.
- Каждый запрос может использовать несколько потоков для обработки данных, что значительно увеличивает производительность при выполнении сложных аналитических запросов.

2. Разделение таблиц (Partitioning):
- ClickHouse поддерживает горизонтальное разделение таблиц (партии), что позволяет разбивать данные на отдельные части, которые могут обрабатываться независимо. Это особенно полезно для управления большими объемами данных.
- Пример:
```sql
CREATE TABLE example (
         id UInt32,
         date Date,
         name String
     ) ENGINE = MergeTree()
     PARTITION BY toYYYYMM(date)
     ORDER BY id;
```

3. Скалярные и агрегационные функции:
- Запросы, использующие агрегационные функции (например, SUM, COUNT), могут выполняться параллельно, обрабатывая данные в разных потоках. Это улучшает общую производительность запросов.

4. Распределенные запросы:
- ClickHouse поддерживает распределенные таблицы, которые позволяют работать с данными, хранящимися на нескольких серверах. Запросы автоматически распределяются между серверами для обеспечения максимальной пропускной способности.

