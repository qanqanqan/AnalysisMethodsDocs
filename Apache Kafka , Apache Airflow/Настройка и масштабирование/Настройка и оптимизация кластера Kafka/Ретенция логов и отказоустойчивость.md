## Ретенция логов и отказоустойчивость в Apache Kafka

### **Ретенция логов**

Ретенция логов в Apache Kafka относится к механизму управления временем хранения сообщений в топиках. Основные аспекты включают:

- **Настройка времени хранения**: Kafka позволяет настраивать параметры ретенции для каждого топика с помощью конфигурации `retention.ms`, которая определяет, как долго сообщения будут храниться. По умолчанию сообщения хранятся 7 дней, но это значение можно изменить в зависимости от требований приложения.

- **Объем хранения**: Кроме времени, можно ограничить объем данных, хранящихся в топике, с помощью параметра `retention.bytes`. Это позволяет управлять использованием дискового пространства и предотвращает переполнение.

- **Удаление старых сообщений**: Когда достигается лимит по времени или объему, старые сообщения автоматически удаляются. Это обеспечивает актуальность данных и освобождает место для новых записей.

### **Отказоустойчивость**

Отказоустойчивость в Apache Kafka достигается через несколько ключевых механизмов:

- **Репликация**: Kafka использует механизм репликации для создания копий сообщений на различных брокерах. Каждая партиция имеет одного лидера и несколько последователей. Лидер обрабатывает все запросы на запись и чтение, а последователи синхронизируют данные с ним. Это обеспечивает доступность данных даже при сбое одного или нескольких брокеров [1][4].

- **Выборы лидера**: В случае сбоя брокера-лидера автоматически происходит перевыбор нового лидера среди доступных последователей. Это позволяет системе продолжать работу без потери данных [1].

- **Настройки подтверждений**: Параметр `acks` у продюсеров определяет, сколько реплик должно подтвердить получение сообщения перед тем, как оно будет считаться успешно отправленным. Установка `acks=all` гарантирует, что сообщение будет подтверждено всеми синхронизированными репликами, что повышает надежность [1][2].

- **Интеграция с ZooKeeper**: Apache ZooKeeper используется для координации брокеров и управления состоянием кластера. Он отслеживает доступность узлов и помогает в процессе выбора лидеров, что критично для поддержания отказоустойчивости [4].

Таким образом, механизмы ретенции логов и отказоустойчивости в Apache Kafka обеспечивают надежное управление данными и высокую доступность системы, что делает ее подходящей для обработки больших объемов информации в реальном времени.

Citations:
[1] https://bigdataschool.ru/blog/kafka-replication-and-leader-election.html
[2] https://slurm.io/blog/tpost/l12ed28mu1-pochemu-kafka-takaya-bistraya
[3] https://bigdataschool.ru/blog/how-to-prevent-kafka-failures.html
[4] https://blog.skillfactory.ru/glossary/kafka-apache/
[5] https://gitverse.ru/blog/articles/architecture/60-obrabotka-i-analiz-dannyh-pri-pomoshi-apache-kafka-chto-eto-takoe-i-principy-raboty-arhitektury
[6] https://datafinder.ru/services/apache-kafka-obzor
[7] https://habr.com/ru/companies/itsumma/articles/474984/
[8] https://habr.com/ru/articles/818007/