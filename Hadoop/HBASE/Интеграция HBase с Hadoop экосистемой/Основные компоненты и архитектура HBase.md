HBase — это распределённая, масштабируемая NoSQL база данных, разработанная для работы с большими объёмами данных. Её архитектура состоит из нескольких ключевых компонентов, каждый из которых выполняет определённую функцию для обеспечения работы системы.

### Основные компоненты HBase:

1. **HBase Master (Мастер-узел)**:
   - Главный сервер, который управляет распределением данных и регионами.
   - Его основная задача — контролировать распределение регионов между RegionServers, отвечать за их создание, слияние и разбиение.
   - Master отслеживает статус RegionServers и координирует их работу, но не участвует в обработке запросов клиентов напрямую.

2. **RegionServer (Региональный сервер)**:
   - Основной компонент для хранения и управления данными в HBase. Каждый RegionServer отвечает за управление несколькими регионами.
   - RegionServer обслуживает запросы на чтение и запись данных.
   - Хранит данные в файлах HFile, которые физически находятся в HDFS.
   - Работает с Write-Ahead Log (WAL) для записи операций перед их применением, чтобы обеспечить отказоустойчивость.

3. **Region (Регион)**:
   - Логическая часть таблицы HBase, которая разбивается на регионы для распределённого хранения.
   - Регион состоит из строк, распределённых по диапазонам ключей. Если размер региона становится слишком большим, он разбивается на два региона для равномерного распределения нагрузки между серверами.

4. **HFile**:
   - Формат хранения данных в HBase. Это файловая структура, которая сохраняется в HDFS.
   - HFile организует данные по ключам строк и обеспечивает высокоэффективное чтение и запись данных.

5. **Write-Ahead Log (WAL)**:
   - Журнал предварительной записи, который хранит все операции записи (put, delete) перед их применением.
   - WAL используется для восстановления данных в случае сбоя сервера. Если RegionServer падает, данные из WAL можно воспроизвести на других серверах.

6. **ZooKeeper**:
   - ZooKeeper выполняет задачи координации и управления метаданными в HBase.
   - Он управляет регистрацией всех RegionServers и HBase Master, отслеживает их состояние и помогает клиентам находить RegionServers для выполнения запросов.
   - Обеспечивает механизм для выбора ведущего узла в случае сбоя мастера.

7. **MemStore**:
   - Внутренняя структура данных в памяти для каждого региона.
   - MemStore хранит данные, которые были записаны, но ещё не сброшены на диск в HFile. Когда MemStore заполняется, данные записываются в HFile.
   - Это буфер для ускорения операций записи в HBase.

8. **Compaction (Компактация)**:
   - Процесс слияния нескольких HFiles в один более крупный файл для оптимизации чтения.
   - Компактация также помогает удалять устаревшие версии данных, чтобы уменьшить объём хранилища и улучшить производительность.

9. **Client API**:
   - HBase предоставляет API для взаимодействия с базой данных. Клиенты могут выполнять операции чтения и записи, такие как `put`, `get`, `delete` и сканирование данных через этот API.
   - API напрямую взаимодействует с RegionServers через ZooKeeper для поиска нужных данных.

### Архитектура HBase:

1. **Таблицы и регионы**:
   - Таблицы в HBase делятся на строки. Каждая строка идентифицируется уникальным ключом строки (row key).
   - Таблицы могут иметь множество столбцов, организованных в семейства столбцов (Column Families). Каждый столбец может иметь множество версий данных.
   - Таблицы делятся на регионы по диапазону ключей строк. Когда регион достигает определённого размера, он автоматически делится на два новых региона.

2. **Региональные серверы (RegionServers)**:
   - Каждый RegionServer обслуживает несколько регионов, и каждый регион может находиться только на одном RegionServer в любой момент времени.
   - RegionServer отвечает за обработку запросов на чтение и запись данных и за выполнение слияний и разбиений регионов.

3. **Мастер-узел (HBase Master)**:
   - HBase Master управляет распределением регионов и взаимодействует с ZooKeeper для отслеживания состояния кластера.
   - Master не участвует напрямую в запросах на чтение и запись — это делает RegionServer.

4. **Хранилище данных (HDFS)**:
   - HBase использует Hadoop HDFS для хранения данных в файловой системе. Все данные сохраняются в HFile на HDFS, что обеспечивает отказоустойчивость и масштабируемость.
   - HDFS предоставляет механизмы репликации данных для надёжного хранения.

5. **Координация через ZooKeeper**:
   - ZooKeeper координирует взаимодействие между HBase Master и RegionServers, помогает клиентам находить RegionServers и управляет процессом восстановления при сбоях.

### Подводя итоги:
Архитектура HBase основана на распределённой системе, которая использует RegionServers для хранения данных и управления операциями, HBase Master для управления регионами, и HDFS для хранения файлов данных. ZooKeeper координирует работу системы, поддерживая отказоустойчивость и высокую доступность.