## Процесс чтения и записи данных в HBase

Процесс чтения и записи данных в HBase включает несколько этапов и компонентов, обеспечивающих высокую производительность и надежность. HBase, как NoSQL база данных, основан на принципах хранения данных в распределенной системе и использует различные механизмы, такие как HLog (Write-Ahead Log) и HFile. Давайте подробнее рассмотрим процесс записи и чтения данных.

### Процесс записи данных в HBase

1. **Запрос на запись**: Запрос на запись данных (например, `put`) поступает от клиента. Клиент обычно использует API HBase для выполнения операций.

2. **Определение региона**: HBase разбивает таблицы на регионы, и каждый регион хранится на конкретном регион-сервере. HBase использует информацию о распределении данных, чтобы определить, к какому региону относится запись.

3. **Кэширование записей**: Перед записью в HFile данные сначала помещаются в `MemStore` (память) этого региона. `MemStore` — это структура данных, которую HBase использует для временного хранения записей, которые еще не записаны на диск. Этот шаг ускоряет процесс записи, так как операции в памяти быстрее, чем записи на диск.

4. **Запись в HLog**: Затем данные записываются в HLog (Write-Ahead Log). Это необходимо для обеспечения надежности: в случае сбоя системы данные могут быть восстановлены из журнала.

5. **Проверка порога**: Когда размер `MemStore` превышает предельно допустимый уровень (например, 128 МБ), активируется процесс записи данных на диск.

6. **Создание HFile**: Данные из `MemStore` записываются в `HFile`, который сохраняется на HDFS (Hadoop Distributed File System). HFile организован так, чтобы обеспечить быструю выборку данных, следуя принципу сортировки по ключам.

7. **Очистка HLog**: После успешной записи данных в HFile и подтверждения системы предыдущих операций могут быть удалены старые записи из HLog для освобождения места и поддержания размера журнала.

### Процесс чтения данных в HBase

1. **Запрос на чтение**: Когда клиент отправляет запрос на чтение данных (например, `get`), запрос попадает на соответствующий регион-сервер.

2. **Определение региона**: Как и при записи, HBase определяет, к какому региону относится ключ запроса.

3. **Проверка MemStore**: Сначала HBase проверяет, есть ли данные в `MemStore` для данного региона. Если данные найдены, они возвращаются клиенту.

4. **Чтение из HFile**: Если данные не находятся в `MemStore`, система запускает поиск в HFile. HBase использует индексы и метаданные, чтобы быстро находить необходимые записи в HFile.

5. **Проверка версий (если применимо)**: Если в таблице разрешено хранение нескольких версий данных, HBase может извлечь запрашиваемую версию. Параметры старой версии также могут быть определены в запросе.

6. **Промежуточные кэширования**: Кроме того, HBase может использовать кэши, такие как блоки и кэш строк, для хранения недавно извлеченных данных, чтобы ускорить повторяющиеся запросы.

7. **Возвращение результата**: Запрашиваемые данные возвращаются клиенту по сети.