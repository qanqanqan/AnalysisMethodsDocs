## Как происходит управление ресурсами в YARN?

Управление ресурсами в YARN (Yet Another Resource Negotiator) обеспечивает эффективное распределение и использование ресурсов в распределённой системе Hadoop. YARN значительно улучшает управление ресурсами в сравнении с предыдущей архитектурой Hadoop, так как отделяет функции управления ресурсами от обработки данных. Вот основные аспекты управления ресурсами в YARN:

### 1. Архитектура YARN

YARN состоит из нескольких основных компонентов, играющих ключевую роль в управлении ресурсами:

- ResourceManager (RM): Главный компонент, ответственный за управление ресурсами в кластере. Он принимает запросы на ресурсы от различных приложений и распределяет доступные ресурсы.

- NodeManager (NM): Запускается на каждом узле в кластере. Он отвечает за мониторинг ресурсов (CPU, память, диск) на локальном узле и управление контейнерами, которые выполняются на этом узле.

- ApplicationMaster (AM): Каждый запущенный экземпляр приложения имеет свой собственный ApplicationMaster, который управляет выполнением самого приложения, включая запрос ресурсов у ResourceManager и управление состоянием контейнеров.

### 2. Процесс управления ресурсами

Управление ресурсами в YARN происходит в несколько этапов:

1. Запуск приложения:
- Когда приложение запускается, оно отправляет заявку на ресурсы ResourceManager. Эта заявка обычно включает в себя информацию о необходимых ресурсах (например, количество контейнеров, объем памяти, количество процессоров).

2. Распределение ресурсов:
- ResourceManager анализирует текущие доступные ресурсы в кластере и принимает решение о распределении контейнеров. Он принимает во внимание загруженность узлов и условия запросов от различных приложений.
- Если ресурсы доступны и запрос может быть удовлетворён, ResourceManager выделяет контейнеры и отправляет информацию NodeManager на соответствующих узлах.

3. Запуск ApplicationMaster:
- ResourceManager выделяет контейнер для запуска ApplicationMaster для приложения. ApplicationMaster отвечает за управление конкретным приложением:
- Он запрашивает необходимые контейнеры для выполнения задач (например, Map или Reduce) и управляет их состоянием.
- ApplicationMaster может также запрашивать дополнительные ресурсы в процессе работы приложения, если это предусмотрено (например, если приложение требует больше ресурсов для выполнения дополнительных задач).

4. Управление NodeManager:
- NodeManager следит за состоянием контейнеров, запущенных на узле, контролируя использование ресурсов и их производительность.
- Если контейнер завершается (успешно или с ошибкой), NodeManager уведомляет ApplicationMaster и ResourceManager о состоянии контейнера.

5. Мониторинг и автоматическое распределение:
- ResourceManager постоянно отслеживает использование ресурсов в кластере и выполненные задачи. Если какая-либо задача работает медленно или падает, ResourceManager может переназначить задачу на другой узел или перезапустить её в новом контейнере.

### 3. Преимущества управления ресурсами в YARN

- Гибкость: YARN позволяет запускать различные типы приложений и workloads в одном кластере, обеспечивая при этом эффективное управление ресурсами.

- Изоляция задач: Разделение между ResourceManager и NodeManager обеспечивает лучшую изоляцию и независимость приложений, что снижает риск конфликта ресурсов.

- Высокая доступность и устойчивость: YARN делает систему более устойчивой к сбоям и позволяет восстанавливать приложения в случае проблем с узлами или контейнерами.

- Эффективное использование ресурсов: YARN оптимизирует расположение контейнеров и динамически регулирует выделение ресурсов в зависимости от нужд приложений.