Как настраиваются очереди в YARN и для чего они используются?
В **YARN (Yet Another Resource Negotiator)** очереди используются для управления ресурсами в кластере и распределения этих ресурсов между различными задачами и пользователями. Очереди позволяют группировать задачи (приложения), ограничивать их ресурсы и приоритизировать их выполнение, что особенно важно для кластеров с несколькими пользователями или проектами. Очереди помогают контролировать использование ресурсов и обеспечивать баланс между разными рабочими нагрузками.

### Зачем используются очереди в YARN:

1. **Эффективное распределение ресурсов:**
   - В больших кластерах с множеством пользователей или задач важно эффективно распределять ресурсы (CPU, память) между ними. Очереди позволяют задать квоты и ограничения для каждой задачи, предотвращая захват всех ресурсов одной задачей.

2. **Приоритизация задач:**
   - Очереди позволяют задавать приоритеты для разных типов задач. Например, задачи с высокой важностью могут быть выполнены раньше или получать больше ресурсов, чем менее приоритетные.

3. **Изоляция и управление ресурсами:**
   - YARN обеспечивает изоляцию между задачами с помощью очередей, что предотвращает влияние одной задачи на работу других. Можно настроить, сколько ресурсов может использовать каждая очередь, чтобы контролировать рабочие нагрузки.

4. **Поддержка многопользовательской среды:**
   - В организациях, где кластер используется многими командами или проектами, очереди помогают распределять ресурсы между этими группами на основе заданных политик. Это позволяет обеспечить справедливое использование кластера и предотвращать конфликты.

### Основные типы планировщиков и очередей в YARN:

1. **FIFO Scheduler (First In, First Out):**
   - Самый простой планировщик, где задачи выполняются в порядке их поступления в очередь. Нет разделения на очереди и приоритизации.
   - Ресурсы распределяются между задачами по очереди, как они были поданы, без учета приоритета или доли ресурсов.

2. **Capacity Scheduler (Планировщик по емкости):**
   - Планировщик на основе емкости. Он позволяет разделить ресурсы кластера на несколько очередей, при этом каждая очередь имеет выделенный процент ресурсов.
   - Очереди могут иметь подочереди, что позволяет создавать сложные иерархии.
   - Если очередь не использует свою емкость, эти ресурсы могут быть временно предоставлены другим очередям.
   - Полезен в ситуациях, когда разные группы пользователей или проектов должны делить кластер с гарантией минимального количества ресурсов для каждого.

3. **Fair Scheduler (Честный планировщик):**
   - Этот планировщик распределяет ресурсы поровну между всеми запущенными задачами. Если в кластере мало задач, каждая получает больше ресурсов, а если задач много, ресурсы делятся между ними справедливо.
   - Можно задавать минимальные и максимальные квоты для каждой очереди или задачи, а также устанавливать приоритеты.
   - Полезен, когда задачи имеют разные приоритеты, и важно обеспечить равное распределение ресурсов при наличии свободных.

### Основные параметры для настройки очередей в YARN:

1. **Capacity (емкость):**
   - Определяет процент ресурсов кластера, выделенных для очереди. Например, если указана емкость 50%, это значит, что очередь может занимать до половины всех ресурсов кластера.

2. **Maximum Capacity (максимальная емкость):**
   - Это максимальный процент ресурсов, который очередь может использовать. Если емкость не используется другими очередями, очередь может временно использовать больше ресурсов до указанного предела.

3. **User Limit (ограничение пользователей):**
   - Определяет процент ресурсов, который может быть выделен одному пользователю в рамках очереди. Это помогает предотвратить захват всех ресурсов одним пользователем.

4. **Priority (приоритет):**
   - Приоритет очереди или задачи может влиять на то, какие задачи будут запущены первыми при нехватке ресурсов. Задачи с более высоким приоритетом будут запускаться раньше.

5. **Minimum/Maximum Resources (минимальные/максимальные ресурсы):**
   - Определяют минимальные и максимальные объемы ресурсов, которые может использовать очередь. Это важно для защиты кластера от перегрузки или для гарантирования, что ресурсы не будут использоваться неэффективно.

### Пример настройки очередей в YARN (Capacity Scheduler):

Файл конфигурации для планировщика ресурсов в YARN — `capacity-scheduler.xml`. Пример базовой настройки:

```xml
<property>
  <name>yarn.scheduler.capacity.root.queues</name>
  <value>queue1,queue2</value>
</property>

<property>
  <name>yarn.scheduler.capacity.root.queue1.capacity</name>
  <value>60</value>
</property>

<property>
  <name>yarn.scheduler.capacity.root.queue2.capacity</name>
  <value>40</value>
</property>

<property>
  <name>yarn.scheduler.capacity.root.queue1.maximum-capacity</name>
  <value>100</value>
</property>

<property>
  <name>yarn.scheduler.capacity.root.queue2.maximum-capacity</name>
  <value>50</value>
</property>
```

В данном примере:
- Создаются две очереди: `queue1` и `queue2`.
- `queue1` получает 60% ресурсов кластера, а `queue2` — 40%.
- Очередь `queue1` может использовать до 100% ресурсов, если остальные очереди не активны, а `queue2` — до 50%.

### Заключение:

Очереди в YARN — это мощный инструмент для управления ресурсами в кластере, обеспечивающий эффективное распределение и контроль за выполнением задач. Правильная настройка очередей позволяет улучшить производительность, балансировать нагрузки и оптимально использовать ресурсы кластера.