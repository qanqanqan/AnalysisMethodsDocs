
Векторное выполнение запросов (Vectorized Query Execution) в Apache Hive — это функция, которая значительно снижает использование CPU при выполнении типичных операций запросов, таких как сканирование, фильтрация, агрегация и соединения. Вместо обработки одной строки за раз, векторизация позволяет обрабатывать блоки строк, что значительно улучшает производительность.

---

## Преимущества векторизации

- **Улучшенная производительность**: Векторизация обрабатывает блоки по 1024 строки, что уменьшает количество вызовов функций и проверок условий, улучшая использование кэша процессора.
- **Снижение нагрузки на CPU**: Обработка массивов данных (векторов) вместо отдельных строк позволяет оптимизировать выполнение арифметических операций и сравнений.

---

## Ограничения

- Векторизация работает корректно только для определенных типов данных.
- Поддержка пользовательских функций (UDF) может быть ограничена; если UDF не поддерживает векторизацию, запрос будет выполняться в стандартном режиме обработки строк.

---

## Как включить векторизацию

Чтобы использовать векторизацию в Hive, необходимо выполнить следующие шаги:
1. **Формат хранения**: Убедитесь, что данные хранятся в формате ORC.
2. **Включение векторизации**: Установите параметр для включения векторизации:
```sql
    SET hive.vectorized.execution.enabled = true;
```
3. **Создание таблицы**: Создайте таблицу с использованием формата ORC:
```sql
    CREATE TABLE test_table_vectorized (     
    id INT,    
    value STRING 
	) STORED AS ORC;
```
---

## Проверка использования векторизации

Для проверки того, используется ли векторизация для конкретного запроса, можно воспользоваться командой `EXPLAIN`:

```sql
EXPLAIN SELECT COUNT(*) FROM test_table_vectorized;
```
Если векторизация активна, вывод будет содержать строку `Vectorized execution: true`.

---

