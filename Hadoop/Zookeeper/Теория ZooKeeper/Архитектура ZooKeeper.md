## Архитектура ZooKeeper

Архитектура Apache ZooKeeper предназначена для обеспечения надежного управления конфигурацией и координации в распределенных системах. Она построена на основе модели клиент-сервер и включает несколько ключевых компонентов и концепций:

### Основные компоненты

1. **Клиенты (Clients)**:
   - Это приложения, которые взаимодействуют с кластером ZooKeeper для чтения и записи данных. Клиенты подключаются к одному из серверов в кластере и отправляют запросы на выполнение операций.

2. **Серверы (Servers)**:
   - ZooKeeper работает в кластере, состоящем из нескольких серверов (узлов). Каждый сервер хранит копию данных и обрабатывает запросы от клиентов.
   - Серверы могут выполнять различные роли: лидер (leader), последователь (follower) и наблюдатель (observer).

3. **Лидер (Leader)**:
   - Лидер отвечает за обработку всех операций записи и координацию изменений данных. Он обеспечивает согласованность данных в кластере, распространяя изменения на последователей.

4. **Последователи (Followers)**:
   - Последователи принимают запросы на чтение от клиентов и участвуют в голосовании за изменения данных. Они синхронизируются с лидером, чтобы поддерживать актуальную версию данных.

5. **Наблюдатели (Observers)**:
   - Наблюдатели — это серверы, которые не участвуют в голосовании за изменения данных, но могут обслуживать запросы на чтение. Они полезны для масштабирования системы без увеличения нагрузки на процесс согласования.

### Протокол ZAB (ZooKeeper Atomic Broadcast)

ZooKeeper использует протокол ZAB для обеспечения надежной передачи и согласованности данных между серверами. Основные функции ZAB включают:

- **Выбор лидера**: В случае сбоя текущего лидера или при инициализации кластера, протокол выбирает нового лидера.
- **Широковещание**: Лидер отправляет изменения данных всем последователям, чтобы они могли обновить свои копии данных.
- **Синхронизация**: Новый лидер должен синхронизироваться с большинством серверов, чтобы гарантировать, что у него самая последняя версия данных.

### Логическая структура данных

1. **ZNode**:
   - В ZooKeeper данные хранятся в виде узлов, называемых ZNodes. Эти узлы организованы в древовидную структуру, подобно файловой системе.
   - Каждый ZNode может содержать данные и метаданные, такие как версия, временные метки и ACL (списки контроля доступа).

2. **Типы ZNode**:
   - **Persistent (Постоянные)**: Существуют до тех пор, пока не будут удалены явно.
   - **Ephemeral (Эфемерные)**: Автоматически удаляются при отключении клиента, который их создал.
   - **Sequential (Последовательные)**: Автоматически получают уникальный последовательный номер при создании.

### Гарантии и особенности

- **Atomicity (Атомарность)**: Все операции записи атомарны.
- **Sequential Consistency (Последовательная консистентность)**: Операции применяются в том порядке, в каком они были отправлены.
- **Single System Image (Единое представление системы)**: Все клиенты видят одно и то же представление данных.
- **Durability (Долговечность)**: Данные сохраняются после подтверждения выполнения операции.

Архитектура ZooKeeper обеспечивает высокую доступность и надежность, что делает его подходящим решением для координации и управления состоянием в распределенных системах.