## Алгоритмы консенсуса в ZooKeeper

В Apache ZooKeeper используется алгоритм консенсуса, известный как ZAB (ZooKeeper Atomic Broadcast), который обеспечивает надежность и согласованность данных в распределенной системе. ZAB предназначен для управления состоянием системы и поддержания согласованности данных между узлами в кластере. Вот основные аспекты и этапы работы ZAB:

### Основные аспекты ZAB

1. **Атомарность**:
   - ZAB обеспечивает атомарность операций, что означает, что изменения данных либо полностью применяются ко всем узлам, либо не применяются вовсе.

2. **Последовательная согласованность**:
   - Все изменения данных применяются в одном и том же порядке на всех узлах, что обеспечивает последовательную согласованность.

3. **Долговечность**:
   - После подтверждения операции изменения данных сохраняются и не теряются даже в случае сбоя узлов.

### Этапы работы ZAB

1. **Выбор лидера**:
   - Когда кластер инициализируется или текущий лидер выходит из строя, ZAB запускает процесс выбора нового лидера.
   - Узел, который получает большинство голосов от других узлов, становится лидером.
   - Лидер отвечает за обработку всех операций записи и координацию изменений данных.

2. **Синхронизация**:
   - После выбора лидера, он должен синхронизироваться с большинством узлов, чтобы убедиться, что у него самая последняя версия данных.
   - Лидер передает последним изменениям данных последователям, чтобы они могли обновить свои копии.

3. **Широковещание (Broadcast)**:
   - Лидер принимает запросы на запись от клиентов и транслирует (широковещает) изменения данных всем последователям.
   - Каждый узел применяет изменения в том порядке, в каком они были получены.

4. **Подтверждение (Commit)**:
   - После того как большинство узлов подтвердят получение и применение изменений, лидер отправляет подтверждение клиенту, инициировавшему запрос.

5. **Обработка отказов**:
   - В случае сбоя лидера или потери кворума, процесс выбора лидера запускается заново.
   - Узлы, которые не могут достичь кворума, не могут выполнять операции записи, чтобы избежать конфликтов.

### Преимущества ZAB

- **Высокая доступность**: Система продолжает работать даже при сбоях отдельных узлов.
- **Согласованность**: Все узлы имеют согласованное представление данных.
- **Надежность**: Данные сохраняются и восстанавливаются после сбоев.

Алгоритм ZAB делает ZooKeeper надежным инструментом для управления состоянием в распределенных системах, обеспечивая согласованность и доступность данных.