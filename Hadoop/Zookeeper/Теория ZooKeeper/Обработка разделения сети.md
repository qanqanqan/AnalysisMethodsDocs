## Обработка разделения сети

Обработка разделения сети (network partitioning) в Apache ZooKeeper является важным аспектом обеспечения надежности и согласованности системы. Разделение сети происходит, когда узлы в кластере теряют возможность обмениваться данными из-за сбоев в сети, что может привести к изоляции части узлов от остальных. ZooKeeper использует несколько механизмов для обработки таких ситуаций:

### Основные концепции и механизмы

1. **Кворум**:
   - ZooKeeper основывается на концепции кворума для принятия решений и обеспечения согласованности данных. Кворум — это минимальное количество серверов, которые должны согласиться на операцию, чтобы она была выполнена. Обычно это большинство серверов в кластере.
   - Кворум помогает предотвратить ситуацию, когда изолированные части кластера продолжают принимать противоречивые решения.

2. **Выбор лидера**:
   - В случае разделения сети, если текущий лидер теряет связь с большинством узлов, он может потерять свой статус лидера. Оставшиеся узлы, образующие кворум, выберут нового лидера.
   - Узлы, которые не могут достичь кворума, не могут выбрать нового лидера и остаются в ожидании восстановления связи.

3. **Согласованность данных**:
   - Узлы, которые не входят в кворум, не могут выполнять операции записи, что предотвращает создание конфликтующих изменений данных.
   - Только узлы, входящие в кворум, могут принимать и подтверждать изменения данных.

4. **Обработка изолированных узлов**:
   - Узлы, оказавшиеся в изоляции, продолжают работать, но не могут выполнять операции записи и не участвуют в голосованиях.
   - Как только связь восстанавливается, изолированные узлы синхронизируются с остальной частью кластера, чтобы обновить свои данные.

5. **Failover и восстановление**:
   - После восстановления связи изолированные узлы автоматически синхронизируются с новым лидером, чтобы получить актуальные данные.
   - ZooKeeper автоматически управляет процессом восстановления и выбора лидера, чтобы минимизировать влияние разделения сети на систему.

### Гарантии и поведение

- **Чтение данных**: Клиенты могут продолжать выполнять операции чтения, если они подключены к узлу, который имеет актуальные данные.
- **Запись данных**: Операции записи блокируются на узлах, которые не входят в кворум, чтобы избежать нарушения согласованности.
- **Долговечность данных**: Все подтвержденные изменения сохраняются и будут доступны после восстановления связи.

ZooKeeper обеспечивает высокую доступность и согласованность данных даже в условиях разделения сети, что делает его надежным решением для координации в распределенных системах.