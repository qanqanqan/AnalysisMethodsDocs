
Выбор лидера и настройка кворума в ZooKeeper обеспечивают надежность и отказоустойчивость распределенных систем. Правильная конфигурация и понимание этих процессов позволяют эффективно управлять состоянием кластера и минимизировать риски сбоев в работе приложений.

---
## Процесс выбора лидера

## Что такое лидер?

Лидер в ZooKeeper — это сервер, который отвечает за обработку всех операций записи и управление состоянием кластера. Остальные серверы (последователи) реплицируют данные от лидера и обрабатывают запросы на чтение.

## Процесс выбора

1. **Запуск сервиса**: При старте сервера ZooKeeper каждый узел в ансамбле (кластер серверов) инициирует процесс выбора лидера.
2. **Обмен сообщениями**: Серверы обмениваются сообщениями, чтобы определить, какой из них станет лидером. Этот процесс включает в себя выбор наиболее "влиятельного" сервера на основе его идентификатора (ID).
3. **Кворум**: Для успешного выбора лидера необходимо, чтобы более половины серверов (кворум) согласились с выбранным лидером. Это обеспечивает устойчивость к сбоям, так как даже при выходе из строя одного или нескольких узлов система продолжает функционировать.
4. **Подтверждение**: После того как лидер выбран, он отправляет подтверждение остальным серверам, которые начинают реплицировать данные от нового лидера.
---
## Настройка кворума

## Что такое кворум?

Кворум — это минимальное количество серверов, необходимых для достижения согласия и обеспечения корректной работы системы. В ZooKeeper рекомендуется использовать нечетное количество серверов (например, 3, 5, 7) для повышения отказоустойчивости.

## Настройка кворума

1. **Конфигурация серверов**: В конфигурационном файле `zoo.cfg` необходимо указать адреса всех серверов в ансамбле и их порты для репликации и выбора лидера:
```text
server.1=192.168.1.10:2888:3888 
server.2=192.168.1.20:2888:3888 
server.3=192.168.1.30:2888:3888`
```
    
2. **Идентификаторы узлов**: На каждом сервере создается файл `myid`, содержащий уникальный идентификатор узла (например, 1 для первого сервера).
3. **Порты**:
    
    - **2181**: Порт для клиентских подключений.
    - **2888**: Порт для репликации данных между серверами.
    - **3888**: Порт для процесса выбора лидера.
    
4. **Запуск сервиса**: После настройки конфигурации необходимо перезапустить ZooKeeper на всех серверах:
```bash
systemctl restart zookeeper
```
---

## Проверка состояния

Для проверки состояния кластера можно использовать команду:

```bash
echo "stat" | nc localhost 2181
```
На одном из серверов должно отображаться состояние "Mode: leader", а на остальных "Mode: follower".

---



