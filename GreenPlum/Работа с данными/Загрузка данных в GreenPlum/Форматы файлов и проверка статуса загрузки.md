# Форматы файлов и проверка статуса загрузки в GreenPlum

GreenPlum поддерживает загрузку данных в различных форматах файлов, что позволяет гибко интегрировать данные из внешних источников. Также важно уметь проверять статус загрузки данных, чтобы убедиться в успешности операций. В этом документе описаны основные поддерживаемые форматы файлов и способы проверки статуса загрузки данных в GreenPlum.

## 1. Поддерживаемые форматы файлов

### 1.1 Формат CSV (Comma-Separated Values)

CSV — один из наиболее распространенных форматов для хранения табличных данных. В этом формате данные разделены запятыми, и каждая строка представляет собой отдельную запись. CSV-файлы широко используются для экспорта и импорта данных между различными системами.

**Особенности**:
- Простота в использовании и чтении.
- Широкая поддержка в различных инструментах и системах.
- Возможность включения заголовков колонок.

### 1.2 Формат TSV (Tab-Separated Values)

TSV — это формат, в котором данные разделяются символом табуляции. Он удобен для использования в ситуациях, где символы запятых могут быть частью значений. 

**Особенности**:
- Использование табуляции в качестве разделителя.
- Удобен для данных с запятыми в текстовых полях.

### 1.3 Текстовые файлы с пользовательскими разделителями

GreenPlum поддерживает текстовые файлы, в которых можно использовать любые разделители между полями данных, такие как точка с запятой, вертикальная черта (pipe) и другие символы.

**Особенности**:
- Поддержка различных типов разделителей (например, вертикальная черта или точка с запятой).
- Гибкость в обработке данных в различных форматах.

### 1.4 Формат JSON

JSON — формат для хранения и передачи неструктурированных данных. GreenPlum позволяет загружать данные в формате JSON через внешние таблицы, что дает возможность работать с данными перед их окончательной загрузкой.

**Особенности**:
- Поддержка сложных и неструктурированных данных.
- Преимущественно используется для интеграции с веб-приложениями и API.

### 1.5 Форматы Avro и Parquet

Форматы Avro и Parquet широко используются для работы с большими данными в распределенных файловых системах, таких как Hadoop (HDFS). GreenPlum поддерживает их через внешние таблицы, что делает их идеальными для обработки больших объемов данных.

**Особенности**:
- Эффективное сжатие и хранение больших данных.
- Оптимизированы для аналитических запросов.

## 2. Проверка статуса загрузки данных

После загрузки данных необходимо убедиться, что процесс был успешным. Для этого GreenPlum предоставляет несколько методов проверки статуса загрузки.

### 2.1 Проверка через `gp_toolkit`

`gp_toolkit` — это системная схема в GreenPlum, которая содержит различные представления для мониторинга состояния базы данных, включая ошибки, возникшие во время загрузки данных.

**Особенности**:
- Позволяет отслеживать ошибки в процессе загрузки данных.
- Подходит для мониторинга системных событий.

### 2.2 Использование системной таблицы `pg_stat_activity`

Системная таблица `pg_stat_activity` предоставляет информацию о текущих активных процессах в GreenPlum, включая загрузку данных. Это позволяет отслеживать активные операции и оценивать их статус.

**Особенности**:
- Поддержка мониторинга активных процессов, таких как загрузка данных.
- Позволяет отслеживать текущее состояние запросов.

### 2.3 Логирование

GreenPlum ведет детализированные логи, в которых фиксируются все операции, включая загрузку данных. Эти журналы можно использовать для диагностики проблем и поиска ошибок.

**Особенности**:
- Логи содержат подробную информацию обо всех операциях, происходящих в системе.
- Используются для анализа ошибок и проблем при загрузке данных.

### 2.4 Подтверждение количества загруженных строк

После завершения загрузки можно выполнить запрос на подсчет строк в таблице, чтобы убедиться, что данные были загружены полностью.

**Особенности**:
- Простой способ проверки фактического количества загруженных строк.
- Позволяет убедиться в корректности выполнения загрузки.

### 2.5 Проверка ошибок в процессе загрузки

При загрузке данных с помощью команды `COPY` можно использовать параметр для записи ошибок в специальную таблицу. Это позволяет продолжать загрузку даже при наличии ошибок и проанализировать некорректные строки позже.

**Особенности**:
- Ошибки записываются в отдельную таблицу для дальнейшего анализа.
- Поддержка диагностики некорректных строк без прерывания процесса загрузки.

---

Эти методы позволяют эффективно управлять процессом загрузки данных в GreenPlum, контролировать корректность выполнения операций и устранять возможные ошибки.
