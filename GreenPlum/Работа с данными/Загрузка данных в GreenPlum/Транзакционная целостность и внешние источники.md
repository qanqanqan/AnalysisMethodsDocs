# Транзакционная целостность и внешние источники в GreenPlum

В контексте работы с большими объемами данных, транзакционная целостность является важным аспектом для обеспечения надежности и точности данных при выполнении операций загрузки и обработки. GreenPlum, будучи MPP (Massively Parallel Processing) системой, поддерживает транзакционную целостность на уровне SQL-операций. Это особенно важно при работе с внешними источниками данных, такими как файлы или внешние системы.

## 1. Транзакционная целостность в GreenPlum

Транзакционная целостность в GreenPlum гарантирует, что каждая операция, связанная с изменением данных, выполняется полностью или не выполняется вовсе. Это включает в себя следующие свойства транзакций, известные как ACID:

- **Атомарность (Atomicity)**: Все изменения в рамках транзакции либо успешно выполняются, либо откатываются в случае ошибки.
- **Согласованность (Consistency)**: Данные остаются в согласованном состоянии до и после выполнения транзакции.
- **Изолированность (Isolation)**: Параллельные транзакции не влияют друг на друга до завершения выполнения.
- **Долговечность (Durability)**: После успешного завершения транзакции ее результаты сохраняются в базе данных даже в случае сбоя системы.

Эти свойства обеспечивают надежность данных, особенно при массовой загрузке или изменении больших объемов данных.

### 1.1 Уровни изоляции транзакций

GreenPlum поддерживает различные уровни изоляции транзакций, что позволяет управлять степенью параллелизма и гарантировать целостность данных при выполнении сложных операций.

Основные уровни изоляции:
- **READ COMMITTED**: Гарантирует, что транзакция видит только те изменения, которые были зафиксированы.
- **SERIALIZABLE**: Самый строгий уровень изоляции, обеспечивающий полную независимость транзакций, как если бы они выполнялись последовательно.

## 2. Внешние источники данных

Внешние источники данных в GreenPlum — это любые источники данных, которые находятся вне базы данных, например, файлы на диске или данные, доступные через внешние API и сервисы. Для работы с внешними источниками используются внешние таблицы и утилиты, такие как `gpfdist` и `gpload`.

### 2.1 Внешние таблицы

Внешние таблицы позволяют получать данные из внешних источников без их непосредственной загрузки в базу данных. Это особенно полезно для предварительного анализа данных перед загрузкой или для работы с постоянно обновляющимися источниками.

**Особенности**:
- **Динамический доступ**: Данные остаются во внешнем источнике, и доступ к ним осуществляется по мере необходимости.
- **Поддержка различных форматов**: Внешние таблицы могут использовать данные в форматах CSV, JSON, Parquet и других.
- **Удобство для ETL-процессов**: Внешние таблицы часто используются как часть ETL-процессов для извлечения данных из внешних систем и последующей загрузки в постоянные таблицы.

### 2.2 Использование `gpfdist` для внешних файлов

`gpfdist` — это специализированный HTTP-сервер, предназначенный для параллельной загрузки файлов из внешних источников. Он помогает ускорить процесс загрузки за счет разделения данных между сегментами GreenPlum, что особенно важно при работе с большими объемами данных.

**Преимущества**:
- **Параллельная загрузка**: Данные могут быть распределены между несколькими узлами для увеличения скорости загрузки.
- **Поддержка различных файловых форматов**: Поддерживает работу с файлами CSV, JSON и другими форматами.

### 2.3 Автоматизация загрузки через `gpload`

`gpload` — это утилита для массовой загрузки данных, которая использует конфигурационные файлы в формате YAML для автоматизации загрузки из внешних файлов или источников данных. Эта утилита упрощает процесс загрузки и позволяет интегрировать внешние данные в GreenPlum.

## 3. Транзакционная целостность при работе с внешними источниками

При загрузке данных из внешних источников важно поддерживать транзакционную целостность, чтобы избежать потерь данных или неполной загрузки в случае ошибок. GreenPlum обеспечивает целостность данных даже при работе с внешними источниками, благодаря следующим механизмам:

### 3.1 Использование внешних таблиц и транзакций

Загрузка данных из внешних таблиц в постоянные таблицы может быть выполнена в рамках одной транзакции. Если в процессе загрузки данных происходит ошибка, вся транзакция откатывается, и данные остаются в первоначальном состоянии. Это гарантирует, что частично загруженные данные не будут присутствовать в таблицах.

### 3.2 Параметр ERROR_LIMIT

Для повышения гибкости при загрузке данных из внешних источников можно использовать параметр `ERROR_LIMIT`. Он позволяет задать максимальное количество ошибок, допустимых при загрузке, без остановки процесса. Это особенно полезно, если данные содержат незначительные ошибки, но в целом загрузка должна продолжиться.

### 3.3 Логирование ошибок

GreenPlum позволяет сохранять ошибки загрузки данных в отдельную таблицу или лог-файл для последующего анализа. Это дает возможность идентифицировать и исправить ошибки без прерывания основного процесса загрузки данных.

## 4. Заключение

Транзакционная целостность и работа с внешними источниками данных — ключевые элементы надежной работы с данными в GreenPlum. Использование внешних таблиц и утилит, таких как `gpfdist` и `gpload`, позволяет эффективно интегрировать внешние данные в систему, при этом поддерживая целостность данных и высокую производительность. GreenPlum обеспечивает мощные механизмы для работы с большими объемами данных, гарантируя, что даже при возникновении ошибок данные останутся в корректном состоянии.
